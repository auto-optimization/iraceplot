#' Create HTML Report from irace data
#' 
#' This function creates an HTML report of the most relevant irace data.  This
#' report provides general statistics and plots that show the best
#' configurations and their performance. Example: <https://auto-optimization.github.io/iraceplot/articles/example/report_example.html>
#'
#' @template arg_irace_results
#'
#' @param filename (`character(1)`)
#' Filename indicating where to save the report (example: `"~/path-to/filename"`)
#' @param sections (`list()`) List of sections to enable/disable. This is useful for disabling sections that may cause problems, such as out-of-memory errors. `NA` means automatically enable/disable a section depending on the memory required.
#'
#' @template arg_interactive
#'
#  Useless imports to suppress a NOTE generated by "R CMD check" 
#' @importFrom DT renderDataTable
#' @importFrom knitr knit
#' 
#' @examples
#' # load(system.file(package="irace", "exdata", "irace-acotsp.Rdata", mustWork = TRUE))
#' # report(iraceResults, filename="report")
#' NULL
#' @export
report <- function(irace_results, filename = "report",
                   sections = list(experiments_matrix = NULL),
                   interactive = base::interactive())
{
  if (missing(irace_results)) stop("irace_results is required")
  # FIXME: replace with irace::read_logfile
  irace_results <- read_logfile(irace_results)

  # Large experiments matrix crashes pandoc.
  if (is.null(sections$experiments_matrix))
    sections$experiments_matrix <- (prod(dim(irace_results$experiments)) < 128L*1024L)
  
  filename <- path_rel2abs(maybe_add_file_extension(filename, "html"))
  message("Creating file", filename, "\n")
  rmarkdown::render(input=system.file("template", "report_html.Rmd", package = "iraceplot"), output_file=filename, clean = FALSE)
  if (interactive) utils::browseURL(filename)
  filename
}
